import dash
from dash import dcc, html
import json
import os

# Initialize Dash
app = dash.Dash(__name__)

# Load data from JSON files in the "data/" directory
# Load data from the most recent JSON file in the "data/" directory
def load_games_data():
    games_data = []
    
    # Directory where your JSON files are located
    data_dir = os.path.join(os.path.dirname(__file__), 'data')
    
    # Get all JSON files and sort them by their timestamp (assuming the filenames include a timestamp)
    json_files = sorted([f for f in os.listdir(data_dir) if f.endswith(".json")], reverse=True)
    
    # Use the most recent file (the first in the sorted list)
    most_recent_file = json_files[0] if json_files else None
    
    # If a file is found, load data from it
    if most_recent_file:
        filepath = os.path.join(data_dir, most_recent_file)
        with open(filepath) as f:
            data = json.load(f)
            for game in data:
                game_time = game['Time'].replace('\n', '').strip()  # Clean up the time
                day_and_matchup = list(game.keys())[1]  # The second column contains the teams/matchup
                day_and_matchup_column_name = list(game.keys())[1].replace(',', ', ')
                teams = game[day_and_matchup].replace('\n', ' ').strip()  # Clean up the teams

                # Extract the "Circa" spread and use it dynamically
                circa_spread = game.get("Circa", "").replace('\n', ' ').strip().split(' ')
                if len(circa_spread) == 4:
                    # First two values for the favorite and last two for the underdog
                    spread_favorite = f"{circa_spread[0]} {circa_spread[1]}"
                    spread_underdog = f"{circa_spread[2]} {circa_spread[3]}"
                else:
                    # Default if Circa spread data is missing or not formatted as expected
                    spread_favorite = "N/A"
                    spread_underdog = "N/A"

                # Add the extracted data to the games_data list
                games_data.append({
                    'time': game_time,
                    'day_and_matchup_column_name': day_and_matchup_column_name,
                    'teams': teams.split('  '),  # Split into two teams
                    'spread': [spread_favorite, spread_underdog],  # Use Circa spread
                    'moneyline': ['N/A', 'N/A'],       # Placeholder, replace dynamically if needed
                    # 'total': ['O 45 -110', 'U 45 -110']  # Placeholder, replace dynamically if needed
                    'total': ['N/A', 'N/A']  # Placeholder, replace dynamically if needed
                })
    return games_data

# Define games_data based on the files in the data directory
games_data = load_games_data()

# # Define layout for the app
# app.layout = html.Div([
#     html.H1("NFL Odds Dashboard", style={'text-align': 'center'}),
    
#     # Loop through games_data and create sections for each game
#     html.Div([
#         html.Div([
#             html.H3(game['time']),
#             html.H3(game['day_and_matchup_column_name']),
#             html.Table([
#                 # Header
#                 html.Tr([
#                     html.Th("Team"),
#                     html.Th("Spread"),
#                     html.Th("Moneyline"),
#                     html.Th("Total")
#                 ]),
#                 # First team row
#                 html.Tr([
#                     html.Td(game['teams'][0]),
#                     html.Td(game['spread'][0]),
#                     html.Td(game['moneyline'][0]),
#                     html.Td(game['total'][0])
#                 ]),
#                 # Second team row
#                 html.Tr([
#                     html.Td(game['teams'][1]),
#                     html.Td(game['spread'][1]),
#                     html.Td(game['moneyline'][1]),
#                     html.Td(game['total'][1])
#                 ])
#             ], style={'width': '100%', 'border': '1px solid black', 'text-align': 'center'})
#         ], style={'margin': '20px', 'border': '1px solid black', 'padding': '20px'})
#         for game in games_data
#     ])
# ])
app.layout = html.Div([
    html.H1("NFL Odds Dashboard", style={'text-align': 'center'}),
    
    # Loop through games_data and create sections for each game
    html.Div([
        html.Div([
            html.H3(game['time']),
            html.H3(game['day_and_matchup_column_name']),
            html.Table([
                # Header
                html.Tr([
                    html.Th("Team"),
                    html.Th("Spread"),
                    html.Th("Moneyline"),
                    html.Th("Total")
                ]),
                html.Tr([
                    html.Td(game['teams'][0], style={'text-align': 'center'}),  # Center team name
                    
                    # First team spread dropdown, centered
                    html.Td(dcc.Dropdown(
                        id=f'spread-dropdown-{game["teams"][0]}',
                        options=[{'label': game['spread'][0], 'value': game['spread'][0]}],
                        value=game['spread'][0],
                        clearable=False,
                        style={'width': '125px', 'margin': 'auto'}  # Center the dropdown
                    ), style={'text-align': 'center'}),  # Center the table cell
                    
                    html.Td(game['moneyline'][0], style={'text-align': 'center'}),
                    html.Td(game['total'][0], style={'text-align': 'center'})
                ]),
                html.Tr([
                    html.Td(game['teams'][1], style={'text-align': 'center'}),  # Center team name
                    
                    # Second team spread dropdown, centered
                    html.Td(dcc.Dropdown(
                        id=f'spread-dropdown-{game["teams"][1]}',
                        options=[{'label': game['spread'][1], 'value': game['spread'][1]}],
                        value=game['spread'][1],
                        clearable=False,
                        style={'width': '125px', 'margin': 'auto'}  # Center the dropdown
                    ), style={'text-align': 'center'}),  # Center the table cell
                    
                    html.Td(game['moneyline'][1], style={'text-align': 'center'}),
                    html.Td(game['total'][1], style={'text-align': 'center'})
                ])
            ], style={'width': '100%', 'border': '1px solid black', 'text-align': 'center'})
        ], style={'margin': '20px', 'border': '1px solid black', 'padding': '20px'})
        for game in games_data
    ])
])

# Run the app
if __name__ == '__main__':
    app.run_server(debug=True)





# import dash
# from dash import html

# # Initialize Dash
# app = dash.Dash(__name__)

# # Define hardcoded data for the games
# games_data = [
#     {
#         'time': '08:15 PM EST - AMAZON PRIME',
#         'teams': ['Dallas Cowboys (1-2)', 'New York Giants (1-2)'],
#         'spread': ['-5½ -110', '+5½ -110'],
#         'moneyline': ['-240', '+200'],
#         'total': ['O 45 -110', 'U 45 -110']
#     },
#     {
#         'time': '01:00 PM EST - FOX',
#         'teams': ['New Orleans Saints (2-1)', 'Atlanta Falcons (1-2)'],
#         'spread': ['+2½ -110', '-2½ -110'],
#         'moneyline': ['+110', '-130'],
#         'total': ['O 42 -110', 'U 42 -110']
#     },
#     {
#         'time': '01:00 PM EST - CBS',
#         'teams': ['Pittsburgh Steelers (3-0)', 'Indianapolis Colts (1-2)'],
#         'spread': ['-1½ -110', '+1½ -110'],
#         'moneyline': ['-125', '+105'],
#         'total': ['O 40 -110', 'U 40 -110']
#     }
# ]

# # Define layout for the app
# app.layout = html.Div([
#     html.H1("NFL Odds Dashboard", style={'text-align': 'center'}),
    
#     # Loop through games_data and create sections for each game
#     html.Div([
#         html.Div([
#             html.H3(game['time']),
#             html.Table([
#                 # Header
#                 html.Tr([
#                     html.Th("Team"),
#                     html.Th("Spread"),
#                     html.Th("Moneyline"),
#                     html.Th("Total")
#                 ]),
#                 # First team row
#                 html.Tr([
#                     html.Td(game['teams'][0]),
#                     html.Td(game['spread'][0]),
#                     html.Td(game['moneyline'][0]),
#                     html.Td(game['total'][0])
#                 ]),
#                 # Second team row
#                 html.Tr([
#                     html.Td(game['teams'][1]),
#                     html.Td(game['spread'][1]),
#                     html.Td(game['moneyline'][1]),
#                     html.Td(game['total'][1])
#                 ])
#             ], style={'width': '100%', 'border': '1px solid black', 'text-align': 'center'})
#         ], style={'margin': '20px', 'border': '1px solid black', 'padding': '20px'})
#         for game in games_data
#     ])
# ])

# # Run the app
# if __name__ == '__main__':
#     app.run_server(debug=True)